## 동시성 문제
- 하나의 빈 인스턴스를 스프링에 등록하면 싱글톤으로 생성된다. 이 객체의 인스턴스가 애플리케이션이 1개만 존재한다.
- 생성된 1개의 객체의 필드를 여러 쓰레드가 동시에 접근하여 동시성문제가 발생한다.
- 여러 쓰레드가 동시에 같은 인스턴스의 필드 값을 변경하면서 발생한다.
- 서비스 초기에는 확률상 잘 나타나지 않고 트래픽이 많아질 수록 자주 발생한다.
- 값을 읽기만 하면 발생하지 않고 값을 변경하려는 곳이 있을 때 발생한다.

### 예시
- Thread-A가 userA로 값을 저장하고 다시 조회를 하려는 순간 Thread-B가 값을 userB로 바꿔서 Thread-A가 값을 조회해도 userB라고 조회가 되버린다.

## 해결방법 ThreadLocal 사용

### ThreadLocal 이란?
- 쓰레드 로컬을 해당 쓰레드만 접근할 수 있는 특별한 저장소를 말한다.
- 사용법
    - 값 저장 : ThreadLocal.set()
    - 값 조회 : ThreadLocal.get()
    - 값 제거 : ThreadLocal.remove()
- 주의점 
    - 쓰레드 로컬을 사용하고 나면 마지막에는 무조건 쓰레드 로컬에 저장된 값을 제거해줘야한다. 그렇지 않으면 쓰레드 로컬에 값이 남아있게 되고 다른 쓰레드가 값을 조회할 때 의도하지 않은 이미 저장된 값이 조회될 수 있다. 
    - WAS는 사용이 끝난 쓰레드를 쓰레드 풀에 반환한다. 쓰레드를 생성하는 비용이 비싸기 때문에 쓰레드 풀을 통해서 쓰레드를 재사용하게된다. 쓰레드 로컬을 제거하지 않으면 계속 값이 살아있기 때문에 쓰레드풀에 있는 쓰레드에 그대로 살아있게된다.